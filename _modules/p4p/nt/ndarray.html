<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>p4p.nt.ndarray &#8212; P4P 4.2.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <script src="../../../_static/documentation_options.js?v=432e6325"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for p4p.nt.ndarray</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Helper for handling NTNDArray a la. areaDetector.</span>

<span class="sd">Known attributes</span>

<span class="sd">&quot;ColorMode&quot;   (inner-most left, as given in NDArray.cpp, numpy.ndarray.shape is reversed from this)</span>
<span class="sd"> 0 - Mono   [Nx, Ny]</span>
<span class="sd"> 1 - Bayer  [Nx, Ny]</span>
<span class="sd"> 2 - RGB1   [3, Nx, Ny]</span>
<span class="sd"> 3 - RGB2   [Nx, 3, Ny]</span>
<span class="sd"> 4 - RGB3   [Nx, Ny, 3]</span>
<span class="sd"> 5 - YUV444 ?</span>
<span class="sd"> 6 - YUV422 ??</span>
<span class="sd"> 7 - YUV411 ???</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">from</span> <span class="nn">..wrapper</span> <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Value</span>
<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="n">alarm</span><span class="p">,</span> <span class="n">timeStamp</span><span class="p">,</span> <span class="n">NTBase</span>

<span class="kn">from</span> <span class="nn">.scalar</span> <span class="kn">import</span> <span class="n">ntwrappercommon</span>


<div class="viewcode-block" id="ntndarray">
<a class="viewcode-back" href="../../../nt.html#p4p.nt.ntndarray">[docs]</a>
<span class="k">class</span> <span class="nc">ntndarray</span><span class="p">(</span><span class="n">ntwrappercommon</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Augmented numpy.ndarray with additional attributes</span>

<span class="sd">    * .attrib    - dictionary</span>
<span class="sd">    * .severity</span>
<span class="sd">    * .status</span>
<span class="sd">    * .timestamp - Seconds since 1 Jan 1970 UTC as a float</span>
<span class="sd">    * .raw_stamp - A tuple (seconds, nanoseconds)</span>
<span class="sd">    * .raw - The underlying :py:class:`p4p.Value`.</span>

<span class="sd">    Keys in the ``attrib`` dictionary may be any python which may be stored in a PVA field,</span>
<span class="sd">    including an arbitrary ``Value``.</span>
<span class="sd">    However, special handling is attempted if the provided ``Value`` appears to be an NTScalar</span>
<span class="sd">    or similar, in which case the .value, .alarm and .timeStamp are unpacked to the NTAttribute</span>
<span class="sd">    and other fields are discarded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ntndarray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">ntwrappercommon</span><span class="o">.</span><span class="n">_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;attribute&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">elem</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># we will fail if dimension[] contains None s, or if</span>
        <span class="c1"># the advertised shape isn&#39;t consistent with the pixel array length.</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">D</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">D</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">dimension</span><span class="p">]</span>
        <span class="n">shape</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

        <span class="c1"># in-place reshape!  Isn&#39;t numpy fun</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span> <span class="ow">or</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># can&#39;t reshape if 0-d, so treat as 1-d if no dimensions provided</span>

        <span class="k">return</span> <span class="bp">self</span></div>



<div class="viewcode-block" id="NTNDArray">
<a class="viewcode-back" href="../../../nt.html#p4p.nt.NTNDArray">[docs]</a>
<span class="k">class</span> <span class="nc">NTNDArray</span><span class="p">(</span><span class="n">NTBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Representation of an N-dimensional array with meta-data</span>

<span class="sd">    Translates into `ntndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Value</span> <span class="o">=</span> <span class="n">Value</span>
    <span class="n">ntndarray</span> <span class="o">=</span> <span class="n">ntndarray</span>

    <span class="c1"># map numpy.dtype.char to .value union member name</span>
    <span class="n">_code2u</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;?&#39;</span><span class="p">:</span><span class="s1">&#39;booleanValue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;byteValue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;h&#39;</span><span class="p">:</span><span class="s1">&#39;shortValue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;i&#39;</span><span class="p">:</span><span class="s1">&#39;intValue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;l&#39;</span><span class="p">:</span><span class="s1">&#39;longValue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="s1">&#39;ubyteValue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;H&#39;</span><span class="p">:</span><span class="s1">&#39;ushortValue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;I&#39;</span><span class="p">:</span><span class="s1">&#39;uintValue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="s1">&#39;ulongValue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="s1">&#39;floatValue&#39;</span><span class="p">,</span>
        <span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="s1">&#39;doubleValue&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<div class="viewcode-block" id="NTNDArray.buildType">
<a class="viewcode-back" href="../../../nt.html#p4p.nt.NTNDArray.buildType">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">buildType</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">_default_type</span>
        <span class="k">if</span> <span class="n">extra</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">aspy</span><span class="p">()</span>
            <span class="n">L</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">Type</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">ret</span><span class="o">.</span><span class="n">getID</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret</span></div>


    <span class="n">_default_type</span> <span class="o">=</span> <span class="n">Type</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;booleanValue&#39;</span><span class="p">,</span> <span class="s1">&#39;a?&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;byteValue&#39;</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;shortValue&#39;</span><span class="p">,</span> <span class="s1">&#39;ah&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;intValue&#39;</span><span class="p">,</span> <span class="s1">&#39;ai&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;longValue&#39;</span><span class="p">,</span> <span class="s1">&#39;al&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;ubyteValue&#39;</span><span class="p">,</span> <span class="s1">&#39;aB&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;ushortValue&#39;</span><span class="p">,</span> <span class="s1">&#39;aH&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;uintValue&#39;</span><span class="p">,</span> <span class="s1">&#39;aI&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;ulongValue&#39;</span><span class="p">,</span> <span class="s1">&#39;aL&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;floatValue&#39;</span><span class="p">,</span> <span class="s1">&#39;af&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;doubleValue&#39;</span><span class="p">,</span> <span class="s1">&#39;ad&#39;</span><span class="p">),</span>
            <span class="p">])),</span>
            <span class="p">(</span><span class="s1">&#39;codec&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;codec_t&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">),</span>
            <span class="p">])),</span>
            <span class="p">(</span><span class="s1">&#39;compressedSize&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;uncompressedSize&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;uniqueId&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;dataTimeStamp&#39;</span><span class="p">,</span> <span class="n">timeStamp</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;alarm&#39;</span><span class="p">,</span> <span class="n">alarm</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;timeStamp&#39;</span><span class="p">,</span> <span class="n">timeStamp</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;dimension&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;aS&#39;</span><span class="p">,</span> <span class="s1">&#39;dimension_t&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;fullSize&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;binning&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">),</span>
            <span class="p">])),</span>
            <span class="p">(</span><span class="s1">&#39;attribute&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;aS&#39;</span><span class="p">,</span> <span class="s1">&#39;epics:nt/NTAttribute:1.0&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span> <span class="s1">&#39;as&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;descriptor&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;alarm&#39;</span><span class="p">,</span> <span class="n">alarm</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;timeStamp&#39;</span><span class="p">,</span> <span class="n">timeStamp</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;sourceType&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span>
            <span class="p">])),</span>
        <span class="p">],</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;epics:nt/NTNDArray:1.0&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildType</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">)</span>

<div class="viewcode-block" id="NTNDArray.wrap">
<a class="viewcode-back" href="../../../nt.html#p4p.nt.NTNDArray.wrap">[docs]</a>
    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrap numpy.ndarray as Value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attrib</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;attrib&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;attrib&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="c1"># loses any special/augmented attributes</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">if</span> <span class="s1">&#39;ColorMode&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attrib</span><span class="p">:</span>
            <span class="c1"># attempt to infer color mode from shape</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;ColorMode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># gray</span>

            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">dims</span><span class="p">)):</span> <span class="c1"># inner-most sent as left</span>
                    <span class="k">if</span> <span class="n">dim</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> <span class="c1"># assume it&#39;s a color</span>
                        <span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;ColorMode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">idx</span>  <span class="c1"># 2 - RGB1, 3 - RGB2, 4 - RGB3</span>
                        <span class="k">break</span> <span class="c1"># assume that the first is color, and any subsequent dim=3 is a thin ROI</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unable to deduce color dimension from shape </span><span class="si">%r</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">dims</span><span class="p">)</span>

        <span class="n">dataSize</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">nbytes</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_annotate</span><span class="p">(</span><span class="n">Value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_code2u</span><span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span><span class="p">],</span> <span class="n">value</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span>
            <span class="s1">&#39;compressedSize&#39;</span><span class="p">:</span> <span class="n">dataSize</span><span class="p">,</span>
            <span class="s1">&#39;uncompressedSize&#39;</span><span class="p">:</span> <span class="n">dataSize</span><span class="p">,</span>
            <span class="s1">&#39;uniqueId&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;attribute&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">translateNDAttribute</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p">)</span> <span class="k">for</span> <span class="n">K</span><span class="p">,</span> <span class="n">V</span> <span class="ow">in</span> <span class="n">attrib</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
            <span class="s1">&#39;dimension&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span>
                           <span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="s1">&#39;fullSize&#39;</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span>
                           <span class="s1">&#39;binning&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                           <span class="s1">&#39;reverse&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span> <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">dims</span><span class="p">)],</span>
        <span class="p">}),</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span></div>


<div class="viewcode-block" id="NTNDArray.unwrap">
<a class="viewcode-back" href="../../../nt.html#p4p.nt.NTNDArray.unwrap">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">unwrap</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unwrap Value as NTNDArray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">V</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Union empty.  treat as zero-length char array</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">V</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">ntndarray</span><span class="p">)</span><span class="o">.</span><span class="n">_store</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="NTNDArray.assign">
<a class="viewcode-back" href="../../../nt.html#p4p.nt.NTNDArray.assign">[docs]</a>
    <span class="k">def</span> <span class="nf">assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">py</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store python value in Value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">V</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">py</span><span class="p">)</span></div>
</div>


<span class="k">def</span> <span class="nf">translateNDAttribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Value</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span> <span class="c1"># assume to be NT-like</span>
        <span class="n">V</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="s1">&#39;alarm&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">V</span><span class="p">[</span><span class="s1">&#39;alarm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;alarm&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;timeStamp&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">V</span><span class="p">[</span><span class="s1">&#39;timeStamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;timeStamp&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">V</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">P4P</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../starting.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../building.html">Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../client.html">Client API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nt.html">Common Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../values.html">Working with Value and Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../server.html">Server API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rpc.html">RPC Server Helpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../internal.html">Internal API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gw.html">PVA Gateway</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../nt.html">p4p.nt</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026, Michael Davidsaver.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>